/* --- LAYOUT E ESTRUTURA --- */
#frame { position: fixed; inset: 12px; display: flex; flex-direction: column; overflow: hidden; z-index: 1; }

.logo-area {
  position: absolute; top: 10px; left: calc(var(--hud-w) + var(--gap)); right: 24px;
  display: flex; align-items: center; gap: 15px; z-index: 10; height: 30px; overflow: hidden;
}
.logo-area img { height: 26px; flex-shrink: 0; }

.hud {
  position: absolute; left: 0; top: 80px; bottom: 80px; width: var(--hud-w);
  display: flex; flex-direction: column; align-items: center; gap: 18px; 
  padding-top: 20px; z-index: 40; 
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  /* Sem borda lateral dura, apenas o fim do background */
}
.hud-separator {
  width: 18px;
  height: 1px;
  background: var(--color-accent-dim);
  margin: 4px 0;
  opacity: 0.6;
}

.drawer {
    position: absolute; left: var(--hud-w); top: 80px; bottom: 80px;
    width: 0; background: var(--bg-drawer); 
    
    /* Borda sutil + Sombra flutuante */
    border-right: var(--border-style);
    box-shadow: var(--shadow-float);
    
    border-top-right-radius: var(--radius);
    border-bottom-right-radius: var(--radius);
    
    overflow: hidden; transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 35; display: flex; flex-direction: column; 
    backdrop-filter: blur(12px); /* Blur mais forte */
}
.drawer.open { width: var(--drawer-w); }
.drawer-header { height: 50px; border-bottom: var(--border-style); display: flex; align-items: center; justify-content: center; padding: 0 15px; flex-shrink: 0; position: relative; }
#closeDrawer { position: absolute; right: 12px; }
.drawer-content { flex: 1; padding: 15px; overflow-y: auto; opacity: 0; transition: opacity 0.2s; }
.drawer.open .drawer-content { opacity: 1; }
.mobile-memo-actions { display: none; margin-top: 12px; }
.mobile-only { display: none; }
.desktop-only { display: block; }

/* GATILHO MOBILE */
.mobile-trigger {
    display: none; position: absolute; left: 0; top: 50%; transform: translateY(-50%);
    width: 16px; height: 48px; background: rgba(255, 255, 255, 0.06); color: var(--color-accent);
    border-radius: 0 8px 8px 0;
    justify-content: center; align-items: center; cursor: pointer; z-index: 50;
    box-shadow: 1px 0 8px rgba(0,0,0,0.35);
    border: 1px solid rgba(255, 255, 255, 0.12);
    opacity: 0;
    pointer-events: none;
}
.mobile-trigger svg { display: none; }
.mobile-trigger::before {
    content: "";
    width: 8px;
    height: 22px;
    background:
        linear-gradient(var(--color-accent), var(--color-accent)) 0 0 / 100% 2px,
        linear-gradient(var(--color-accent), var(--color-accent)) 0 10px / 100% 2px,
        linear-gradient(var(--color-accent), var(--color-accent)) 0 20px / 100% 2px;
    background-repeat: no-repeat;
    display: block;
    opacity: 0.7;
}
body.mobile-hud-open .mobile-trigger,
body.drawer-open .mobile-trigger {
    opacity: 0;
    pointer-events: none;
}
body.mobile-edge .mobile-trigger {
    opacity: 0.55;
    pointer-events: auto;
}
body.mobile-typing .mobile-trigger {
    opacity: 0.2;
    pointer-events: auto;
}

/* MOBILE CONTROLS MODAL */
.mobile-controls-trigger {
    display: none;
    position: absolute;
    left: 50%;
    bottom: 10px;
    transform: translateX(-50%);
    width: 44px;
    height: 32px;
    border-radius: 10px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    background: rgba(255, 255, 255, 0.05);
    box-shadow: 0 8px 20px rgba(0,0,0,0.25);
    padding: 6px 8px;
    z-index: 60;
}
.mobile-controls-trigger span {
    display: block;
    height: 2px;
    margin: 4px 0;
    background: var(--color-accent);
    opacity: 0.75;
}
.mobile-controls-close {
    display: none;
    align-self: flex-end;
    width: 34px;
    height: 34px;
    border-radius: 10px;
    margin-bottom: 10px;
}
.controls-inner .mobile-controls-close { display: none !important; }

.drawer-actions-panel {
    display: grid;
    gap: 14px;
}
.drawer-section-title {
    font-size: 10px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--color-muted);
}
.drawer-actions-grid {
    display: grid;
    gap: 8px;
}
.drawer-actions-grid .btn-full {
    opacity: 0.8;
}
.drawer-actions-grid .btn-full:nth-child(-n+3) {
    opacity: 1;
}
.drawer-search {
    display: grid;
    gap: 8px;
}
.drawer-search-row {
    display: grid;
    grid-template-columns: 20px 1fr auto;
    gap: 8px;
    align-items: center;
}
.drawer-search-actions {
    display: flex;
    gap: 8px;
    justify-content: flex-end;
}
.drawer-tabs-mobile {
    display: none;
}
.drawer-tab-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 42px;
    height: 42px;
    border-radius: 12px;
    border: var(--border-style);
    background: rgba(255, 255, 255, 0.04);
    color: var(--color-accent);
}
.drawer-tab-btn .icon { width: 20px; height: 20px; }

/* PAINEL CENTRAL RESPONSIVO */
.panel {
  position: absolute; left: 0; right: 0; top: 60px; bottom: 80px;
  padding: 0 20px; overflow-y: auto; overflow-x: hidden;
  display: flex; justify-content: center; z-index: 1;
  background: transparent;
}

#booksView {
  position: absolute;
  top: 0;
  bottom: 0;
  left: var(--hud-w);
  right: 0;
}

#booksFrame {
  position: absolute;
  inset: 0;
}

.panel.books-active {
  padding: 0;
}

#editorView {
  position: relative;
  width: 100%;
  display: flex;
  justify-content: center;
  overflow: visible;
}

#editorWrap {
  position: relative;
  width: 58vw;
  max-width: 860px;
  min-height: 80vh;
  margin-top: 20px;
  overflow: visible;
}

#editor {
  width: 100%;
  min-height: 80vh;
  outline: none; caret-color: var(--color-accent);
  padding-bottom: 100px; line-height: 1.85;
  white-space: pre-wrap; word-break: break-word; overflow-wrap: break-word;
  position: relative;
  z-index: 1;
  overflow: visible;
  max-height: none;
  height: auto;
  text-align: left;
}

/* CONTROLS (Correção de posição e tamanho) */
.controls {
  position: absolute; left: 0; right: 0; bottom: 14px;
  min-height: var(--controls-h); display: flex; justify-content: center;
  z-index: 50; pointer-events: none; 
}

.controls-inner {
  display: flex; align-items: center; gap: 12px; padding: 0 18px;
  background: var(--bg-controls); 
  border: var(--border-style); /* Borda Glass */
  box-shadow: var(--shadow-float); /* Sombra */
  border-radius: var(--radius);
  
  pointer-events: auto;
  
  /* SEGREDO DA LINHA ÚNICA */
  flex-wrap: wrap;
  white-space: nowrap;
  overflow: visible;
  row-gap: 5px;
  column-gap: 8px;
  
  width: auto; max-width: 96vw; /* Ajusta ao conteúdo, mas não passa da tela */
  height: auto;
  min-height: var(--controls-h);
  
  backdrop-filter: blur(12px); 
}
.controls-inner::-webkit-scrollbar { display: none; }

/* MOBILE */
@media (max-width: 900px) {
    .hud { transform: translateX(-100%); background: var(--bg-drawer); border-right: var(--border-style); height: 100%; top: 0; bottom: 0; left: 0; width: 56px; }
    .mobile-trigger { display: flex; opacity: 0.6; pointer-events: auto; }
    .hud.mobile-open { transform: translateX(0); box-shadow: 5px 0 50px rgba(0,0,0,0.5); }
    .drawer { left: 0; width: 0; top: 0; bottom: 0; border-radius: 0; }
    .drawer.open { width: 100vw; }
    #editorWrap { width: 92vw; margin-top: 8px; }
    #booksView { left: 0; }
    .logo-area { display: none; }
    .panel { top: 10px; bottom: 10px; padding: 0 14px; }
    .controls { display: none; }
    .mobile-controls-trigger { display: none; }
    .controls-inner { display: none; }
    body.mobile-controls-open .controls-inner {
        display: flex;
        position: fixed;
        inset: 0;
        z-index: 80;
        padding: 24px;
        gap: 14px;
        flex-wrap: wrap;
        align-content: flex-start;
        justify-content: center;
        max-width: 100vw;
        max-height: 100vh;
        overflow-y: auto;
    }
    body.mobile-controls-open .mobile-controls-trigger { opacity: 0; pointer-events: none; }
    body.mobile-controls-open .mobile-controls-close { display: inline-flex !important; }
    body.mobile-controls-open .controls-inner .status-label { display: block; }
    body.mobile-controls-open .controls-inner .search-wrapper {
        min-width: 100%;
        max-width: 100%;
        flex: 1 1 100%;
        order: 0;
    }
    body.mobile-controls-open .controls-inner .btn span { display: inline; }
    body.mobile-controls-open .controls-inner .btn { padding: 8px 10px; min-width: 44px; font-size: 11px; }
    body.mobile-controls-open .controls-inner .btn-icon { width: 34px; height: 34px; }
    body.mobile-controls-open .controls-inner .search-input { font-size: 13px; }
    .drawer.mobile-all { width: 100vw; top: 0; bottom: 0; border-radius: 0; }
    .drawer.mobile-all .drawer-tabs-mobile { display: none; }
    .drawer.mobile-all .drawer-content { display: block !important; opacity: 1; }
    .drawer.mobile-all .drawer-content + .drawer-content { border-top: var(--border-style); }
    .drawer.mobile-all { overflow-y: auto; }
    .drawer.mobile-all .drawer-header { position: sticky; top: 0; background: var(--bg-drawer); z-index: 2; }
    .mobile-memo-actions { display: block; }
    .mobile-only { display: block; }
    .desktop-only { display: none; }
    body.mobile-lite #editorView { display: none; }
    body.mobile-lite #booksView { display: none; }
    body.mobile-lite .controls { display: none; }
    body.mobile-lite .logo-area { display: none; }
    body.mobile-lite .panel { top: 0; bottom: 0; padding: 0 14px; }
    body.mobile-lite .drawer { left: 0; }
    body.mobile-lite #mobileTabNav,
    body.mobile-lite #mobileTabTheme,
    body.mobile-lite #mobileTabBooks,
    body.mobile-lite #panelNav,
    body.mobile-lite #panelActions { display: none !important; }
    body.mobile-lite .drawer-search { display: none; }
    body.mobile-lite #panelFiles .file-actions { flex-wrap: wrap; }
    body.mobile-lite #btnScanQr { order: -1; }
    .drawer-tabs-mobile {
        display: flex;
        gap: 10px;
        padding: 10px 14px;
        border-bottom: var(--border-style);
        justify-content: space-between;
    }
}
